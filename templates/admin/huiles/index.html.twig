{% extends 'base.html.twig'%}

{% block title 'Administration'%}

{% block body %}
	<h1 class="text-center">Administration</h1>
	<div class="mx-2">
		{% for message in app.flashes('success')  %}
			<div class="bg-green-200  text-center text-3xl p-2 mb-2 rounded-lg mx-20">
				{{message}}
			</div>
		{% endfor %}
		<div class="flex flex-col">
			<a href="{{path('admin_huiles_create')}}">
				<button class="text-green text-xl border-green border-2 p-3 rounded-lg outline-none">
					Ajouter Huile
				</button>
			</a>

			<a href="{{path('admin_famille_create')}}">
				<button class="text-green text-xl border-green border-2 p-3 rounded-lg outline-none ">
					Ajouter Famille
				</button>
			</a>
		</div>
		<div class="shadow-lg my-10">
			<h1 class="text-center">Familles</h1>
			<div>
				<ul class="flex flex-wrap justify-evenly text-center text-xl uppercase font-semibold">
					<li class="w-40">nom famille</li>
					<li class="w-40">active</li>
					<li class="w-40">actions</li>
				</ul>
			</div>
			<div>
				{% for family in families|sort((a, b) => a.name <=> b.name)%}
					<ul class="flex flex-wrap justify-evenly text-center shadow-lg py-4">
						<li class="w-40 font-semibold text-xl my-auto">
							{{family.name}}</li>
						<li class="w-40 font-semibold text-xl my-auto">
							<label class="switch">
								<input type="checkbox" {{(family.active) ? 'checked' : ''}} data-id="{{family.id}}">
								<span class="slider"></span>
							</label>
						</li>
						<li class="w-40">
							<form method="post" action="{{path('admin_family_delete',{id:family.id})}}" onsubmit="return confirm('Etes vous sûr de vouloir supprimer {{family.name }}?')">
								<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ family.id) }}">
								<input type="hidden" name="_method" value="DELETE">
								<button class="text-red-500 text-xl border-red-500 border-2 p-3 rounded-lg focus:outline-none">Supprimer</button>
							</form>
						</li>
					</ul>
				{% endfor %}
			</div>
		</div>
		<div class="shadow-lg my-10">
			<h1 class="text-center">Huiles</h1>
			<div>
				<ul class="flex flex-wrap justify-evenly text-center text-xl uppercase font-semibold">
					<li class="w-40">id</li>
					<li class="w-40">nom</li>
					<li class="w-96">description</li>
					<li class="w-40">capacité</li>
					<li class="w-40">prix</li>
					<li class="w-40">famille</li>
					<li class="w-40">active</li>
					<li class="w-40">actions</li>
				</ul>
			</div>
			<div>

				{% for huile in huiles|sort((a, b) => a.name <=> b.name) %}

					<ul class="flex flex-wrap justify-evenly text-center shadow-lg py-4">
						<li class="-w-10 lg:w-40 my-auto text-green text-xl font-bold">{{huile.id}}</li>
						<li class="-w-10 lg:w-40 font-semibold text-xl my-auto">{{huile.name}}</li>
						<li class="w-96 my-auto text-lg">{{huile.description}}</li>
						<li class="w-40 font-semibold text-xl my-auto">{{huile.capacity}}
							ml</li>
						<li class="w-40 font-semibold text-xl my-auto">{{huile.price}}
							€</li>
						<li class="w-40 font-semibold text-xl my-auto">
							{% if  huile.family %}
								{{huile.family.name}}
							{% endif %}
						</li>
						<li class="w-40 font-semibold text-xl my-auto">
							<label class="switch">
								<input type="checkbox" {{(huile.active) ? 'checked' : ''}} data-id="{{huile.id}}">
								<span class="slider"></span>
							</label>
						</li>
						<li class="w-40 my-auto">
							<a href="{{path('admin_huiles_edit', { id: huile.id })}}">
								<button class="text-green text-xl border-green border-2 p-3 rounded-lg focus:outline-none mx-2">Modifier</button>
							</a>
							<form method="post" action="{{path('admin_huiles_delete',{id:huile.id})}}" onsubmit="return confirm('Etes vous sûr de vouloir supprimer {{huile.name }}?')">
								<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ huile.id) }}">
								<input type="hidden" name="_method" value="DELETE">
								<button class="text-red-500 text-xl border-red-500 border-2 p-3 rounded-lg focus:outline-none">Supprimer</button>

							</form>
						</li>
					</ul>

				{% endfor %}
			</div>

		</div>
	</div>
{% endblock %}
{% block javascripts %}
	<script>
		window.onload = () => {

let activer = document.querySelectorAll("[type=checkbox]")
for (let bouton of activer) {
bouton.addEventListener("click", function () {
let xmlhttp = new XMLHttpRequest;

xmlhttp.open("get", `/admin/activer/${
this.dataset.id
}`);
xmlhttp.send();
})
}

for (let boutonFamily of activer) {
boutonFamily.addEventListener("click", function () {
let xmlhttp = new XMLHttpRequest;

xmlhttp.open("get", `/admin/activer/family/${
this.dataset.id
}`);
xmlhttp.send();
})
}
}
	</script>
	<script src="{{asset('js/main.js')}}"></script>
{% endblock %}
